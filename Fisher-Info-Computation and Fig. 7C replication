%% fig7c_analytic.m
% Reproduce Figure 7c-style FI curves analytically (no decoding, no Monte Carlo)

clear; clc; close all;

%% Stimulus values (used conceptually; only s0 matters for f')
s1 = 180;
s2 = 185;
s0 = (s1 + s2) / 2;

% Population parameters
N_pop    = 1000;            % large true population ("infinite" population)
N_values = 10:10:600;       % number of simultaneously recorded neurons

%% Differential correlation parameters (as in the paper example)
sigma_ind = sqrt(76.5);
sigma_s   = sqrt(3.5);

%% Define tuning curves for full population
rng(1);
scale_b = 3;                             % slope magnitude
b_full  = scale_b * randn(N_pop,1);      % slope = f'(s0)
f0_full = 20 + 5*randn(N_pop,1);         % random baseline firing rates (not needed for FI)

%% Build full covariance matrix Σ = σ_ind^2 I + σ_s^2 b b^T
Sigma_full = sigma_ind^2 * eye(N_pop) + sigma_s^2 * (b_full * b_full');

%% Compute FI(N) analytically: I(N) = b_N^T Σ_N^{-1} b_N
FI_N = zeros(size(N_values));
for idx = 1:numel(N_values)
    N    = N_values(idx);
    idxN = 1:N;
    b_N   = b_full(idxN);
    Sig_N = Sigma_full(idxN, idxN);
    FI_N(idx) = b_N' * (Sig_N \ b_N);
end

%% Asymptotic / full-population FI
FI_full = b_full' * (Sigma_full \ b_full);

fprintf("Asymptotic FI (N = %d) = %.4f\n", N_pop, FI_full);

%% Plot (Fig 7c style)
figure; hold on;

plot(N_values, FI_N, 'LineWidth', 2.0, 'Color', [0 0.4470 0.7410]); % one smooth blue curve
yline(FI_full, 'k--', 'LineWidth', 2, 'DisplayName', 'Asymptotic FI (N = 1000)');

xlabel('Number of simultaneously recorded neurons N');
ylabel('Fisher information');
title('Analytic reproduction of Figure 7c (Moreno-Bote et al. 2014)');
grid on;
set(gca, 'FontSize', 12);
legend('FI(N)', 'Location', 'Southeast');

hold off;
